<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <title>ポケスリ食材計算ツール</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="css/style.css">
  <link rel="icon" href="data:,">
</head>
  <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-Y5J6145CMR"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-Y5J6145CMR');
</script>
<body>
  <header class="container py-3">
    <h1 class="h4 m-0">ポケスリ食材計算ツール</h1>
    <p class="text-muted small mb-0">ポケモンスリープの食材計算ツールを作ってみました。</p>
  </header>

  <main class="container">
    <div class="row g-3">
      <!-- 左カラム：グループ1＆2 -->
      <div class="col-12 col-lg-6">
        <div class="sticky-col">
          <!-- ANCHOR:G1 -->
          <div class="card mb-3">
            <div class="card-body">
              <div class="mb-2">
                <div class="btn-group" role="group" aria-label="weekly group">
                  <input type="radio" class="btn-check" name="weeklyGroup" id="wgA" autocomplete="off" value="A" checked>
                  <label class="btn btn-outline-primary" for="wgA" id="wgLabelA">カレー</label>
                  <input type="radio" class="btn-check" name="weeklyGroup" id="wgB" autocomplete="off" value="B">
                  <label class="btn btn-outline-primary" for="wgB" id="wgLabelB">サラダ</label>
                  <input type="radio" class="btn-check" name="weeklyGroup" id="wgC" autocomplete="off" value="C">
                  <label class="btn btn-outline-primary" for="wgC" id="wgLabelC">デザート</label>
                </div>
              </div>

              <div class="mb-2">
                <select id="recipeSelect" class="form-select" aria-label="料理を選択"></select>
              </div>

              <!-- G1プレビュー（横一行固定、横スクロール） -->
              <div id="g1Preview" class="g1-preview small mb-2" aria-live="polite" aria-atomic="true"></div>

              <div class="input-group input-group-sm stepper-compact">
                <button id="qtyMinus" class="btn btn-outline-secondary btn-step" type="button">－</button>
                <input id="qtyInput" class="form-control qty-input" type="number" inputmode="numeric" pattern="[0-9]*" value="1" min="1" step="1">
                <button id="qtyPlus" class="btn btn-outline-secondary btn-step" type="button">＋</button>
              </div>

              <div class="mt-2">
                <button id="addBtn" class="btn btn-primary btn-sm" type="button">追加</button>
              </div>
            </div>
          </div>

          <!-- ANCHOR:G2 -->
          <div id="group2Card" class="card d-none">
            <div class="card-header d-flex align-items-center justify-content-between">
              <span class="fw-semibold">追加済みレシピ</span>
              <button id="clearAllBtn" class="btn btn-sm btn-outline-danger" type="button" aria-label="追加済みレシピを全削除">全削除</button>
            </div>
            <div class="card-body" id="group2Body">
              <p class="empty-hint m-0">まだ料理がありません。「追加」で投入してください。</p>
            </div>
          </div>
        </div>
      </div>

      <!-- 右カラム：グループ3（常時表示） -->
      <div class="col-12 col-lg-6">
        <!-- ANCHOR:G3 -->
        <div id="group3Card" class="card">
          <div class="card-header d-flex align-items-center justify-content-between">
            <span class="fw-semibold">食材合計</span>
            <button id="resetStockBtn" class="btn btn-sm btn-outline-secondary" type="button" aria-label="在庫をクリア">在庫クリア</button>
          </div>
          <div class="card-body">
            <!-- ▼ カメラUI -->
            <div id="cameraPanel" class="mb-3">
              <div class="d-flex align-items-center camera-row gap-2 mb-2">
                <button id="cameraToggle" class="btn btn-outline-secondary btn-sm" type="button"
                        aria-pressed="false" aria-expanded="false" aria-controls="cameraArea" aria-label="カメラを開閉">📷</button>
                <button id="cameraRefresh" class="btn btn-outline-secondary btn-sm ms-2 d-none" type="button" aria-label="リセット">↻</button>
              </div>
              <div id="cameraArea" class="camera-stack d-none" aria-hidden="true">
                <div>
                  <input id="cameraFile" type="file" accept="image/*" class="d-none" />
                  <button id="fileSelectBtn" class="btn btn-outline-primary btn-sm" type="button" aria-label="ファイルを選択">ファイルを選択</button>
                  <span id="fileName" class="ms-2 text-muted small">未選択</span>
                </div>
                <!-- 行数選択（1|2|3|4） -->
                <div>
                  <div id="rowCount" class="btn-group" role="group" aria-label="行数選択">
                    <button type="button" class="btn btn-outline-secondary btn-sm" data-rows="1" aria-pressed="false" title="グリッドの行数を1に設定">1</button>
                    <button type="button" class="btn btn-outline-secondary btn-sm" data-rows="2" aria-pressed="false" title="グリッドの行数を2に設定">2</button>
                    <button type="button" class="btn btn-outline-secondary btn-sm" data-rows="3" aria-pressed="false" title="グリッドの行数を3に設定">3</button>
                    <button type="button" class="btn btn-outline-secondary btn-sm active" data-rows="4" aria-pressed="true" title="グリッドの行数を4に設定">4</button>
                  </div>
                </div>
                <!-- gapX, yOffset スライダー（将来的に tileH も追加余地） -->
<!-- gapX → yOffset の順に縦配置 -->
<div class="mb-2">
  <label for="cameraSlider1" class="form-label mb-1 small">間隔</label>
  <input id="cameraSlider1" type="range" min="0" max="100" value="50" class="form-range" aria-label="gapX">
</div>
<div class="mb-2">
  <label for="cameraSlider2" class="form-label mb-1 small">垂直</label>
  <input id="cameraSlider2" type="range" min="0" max="100" value="50" class="form-range" aria-label="yOffset">
</div>

                <div class="d-flex gap-2">
                  <button id="cameraReadBtn" class="btn btn-primary btn-sm" type="button">読取</button>
                  <div id="ocrStatus" class="small text-muted align-self-center"></div>
                </div>
                <!-- サムネイル／結果の最有力候補ライン（生文字列） -->
                <div id="gridPreview" class="mb-2 d-none" aria-label="グリッドOCRプレビュー">
                  <div id="tileThumbs"></div>
                  <div id="bestLine" class="small text-muted"></div>
                </div>
                <!-- 確認パネル（あいまい／重複時のみ表示） -->
                <div id="confirmPanel" class="d-none"></div>
                <!-- 残タイルの処理（破棄/手動割当） -->
                <div id="leftoverPanel" class="d-none"></div>
                <!-- デバッグ出力（トグルON時のみ） -->
                <div id="ocrDebug" class="mt-2">
                  <div class="small" style="color:#666">デバッグ出力（倍率・生文字列・候補など）</div>
                  <pre id="debugPre" class="p-2 border bg-light" style="max-height:260px; overflow:auto; font-size:12px;"></pre>
                </div>
              </div>
            </div>
            <!-- ▲ カメラUI -->

            <!-- 合計テーブル -->
            <div class="table-responsive">
              <table id="totalTable" class="table table-sm align-middle">
                <thead>
                  <tr>
                    <th scope="col">食材</th>
                    <th scope="col">必要</th>
                    <th scope="col">所持</th>
                    <th scope="col">不足</th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
              <p id="totalEmpty" class="empty-hint">まだレシピがありません。</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- トースト（下右） -->
  <div class="toast-container">
    <div id="applyToast" class="toast" role="status" aria-live="polite" aria-atomic="true">
      <div class="toast-header">
        <strong class="me-auto">所持を上書きしました</strong>
        <small class="text-muted">OCR</small>
        <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
      </div>
      <div class="toast-body"></div>
    </div>
  </div>

  
  <script src="js/data.js"></script>
  <script src="js/storage.js"></script>
  <script src="js/ui_g1.js"></script>
  <script src="js/ui_g2.js"></script>
  <script src="js/ui_g3.js"></script>
  <script src="js/ocr_engine.js"></script>
  <script src="js/ocr_grid_io.js"></script>
  <script src="js/ocr_pipeline.js"></script>
  <script src="js/ocr_core.js"></script>
  <script src="js/ocr_ui.js"></script>
  <script src="js/ocr_debug.js"></script>
  <script src="js/init.js"></script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
